<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Why You Should Care About SELinux :: Writing Targeted Policies for SELinux on RHEL</title>
    <link rel="prev" href="index.html">
    <link rel="next" href="s2-intro-quiz.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">Writing Targeted Policies for SELinux on RHEL</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/selinux-policies/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="selinux-policies" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Writing Targeted Policies for SELinux on RHEL</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Review of SELinux</a>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="s1-intro.html">Why You Should Care About SELinux</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="s2-intro-quiz.html">Quiz: Do you need a custom SELinux policy?</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="s2-intro-quiz-answers.html">Answers to the Quiz</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="s3-labels.html">SELinux Policies, Labels, and Contexts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="s4-setup-lab.html">Lab: Verify the SELinux Status of a RHEL Machine</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="s5-rhel.html">How Red Hat Protects System Services With SELinux on RHEL</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="s7-containers.html">How Red Hat Protects Containers With SELinux on RHEL</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../ch2-configure/index.html">SELinux Management</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch2-configure/s1-avc.html">Interpreting AVC messages</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch2-configure/s2-troubleshoot-lab.html">Lab: Troubleshooting SElinux policies</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch2-configure/s3-support.html">Supporting SELinux</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch2-configure/s4-support-lab.html">Lab: Supporting SElinux</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch2-configure/s5-multihost.html">Consistent SElinux settings</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Writing Targeted Policies for SELinux on RHEL</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Writing Targeted Policies for SELinux on RHEL</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Writing Targeted Policies for SELinux on RHEL</a></li>
    <li><a href="index.html">Review of SELinux</a></li>
    <li><a href="s1-intro.html">Why You Should Care About SELinux</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Why You Should Care About SELinux</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><em>Estimated reading time: <strong>5 minutes</strong>.</em></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Objective</dt>
<dd>
<p>Review the purpose of SELinux and evaluate the need for custom SELinux policies.</p>
</dd>
</dl>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Pending Review
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_do_not_disable_selinux"><a class="anchor" href="#_do_not_disable_selinux"></a>Do Not Disable SELinux!</h2>
<div class="sectionbody">
<div class="paragraph">
<p>SELinux has come a long way since the early days of RHEL 5, when it was complex to use and got in the way of deploying common workloads. At that time, it was easy to find people advising to disable SELinux in order to make something work. It wasn&#8217;t good advice!</p>
</div>
<div class="paragraph">
<p>Nowadays (actually since the days of RHEL 7) both the tooling and the policies provided by Red Hat as part of RHEL already evolved to solve most complains, real or perceived. There&#8217;s very little reason to run any machine, including end-user workstations and test servers, with either SELinux disabled or in permissive mode. In fact, you will perform all hands-on activities from this course with SELinux enabled and in enforcing mode!</p>
</div>
<div class="paragraph">
<p>IT professionals are under increasing demand to adopt and improve security practices. DevOps evolved into DevSecOps and development teams are expected to "shift left" security, which means security is a concern of all professionals, not just the administrators of mission-critical production servers. Opting out of such a powerful and mature security technology as SELinux is not a good practice.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s emphasize this critical advice:</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
All organizations should to run all their RHEL machines and VMs, and also all their CentOS and Fedora machines and VMs, with <strong>SELinux enabled</strong> and in <strong>enforcing mode</strong>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_what_is_selinux"><a class="anchor" href="#_what_is_selinux"></a>What is SELinux</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Skipping the <a href="https://en.wikipedia.org/wiki/Security-Enhanced_Linux#History">history</a> <a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/5/html/deployment_guide/rhlcommon-appendix-0005">lesson</a>, suffices to say that SELinux is a security mechanism that enforces policy rules for every process in the system, no matter which user started the proccess.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/s1-intro-fig-1.svg" alt="s1 intro fig 1">
</div>
</div>
<div class="paragraph">
<p>SELinux <strong>policies</strong> control access to any <strong>object</strong> managed by the Linux Kernel, such as files and TCP ports. Processes can access objects only if allowed by the current SELinux policy in the kernel. If the policy do not allow access, them access is denied.</p>
</div>
<div class="paragraph">
<p>Unlike file system permissions, SELinux rules cannot be waived by any user, not even by root. Besides that, regular users cannot change the policy to state that an object is acessible to other users, like they could do with file system permissions. SELinux policies are mandatory. They are not optional, or discretionary. This what they mean when they say SELinux is a Mandatory Access Control (MAC) technology, instead of a Discretionary Access Control (DAC) technilogy such as POSIX file permissions.</p>
</div>
<div class="paragraph">
<p>SELinux is not a replacement for other security mechanisms in Linux, such as Netfilter packet-inspection firewalls and Seccomp. These mecanisms continue to affect all processes, and SELinux can deny access where those other mechanisms granted access. POSIX file permissions are not gone either. They all should be used together to enforce a good security posture.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_using_selinux"><a class="anchor" href="#_why_using_selinux"></a>Why Using SELinux</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The biggest benefit of SELinux is protecting systems from zero-day vulnerabilities. No matter what kind of exploit exists in an application, such as a buffer overflow or a code injection bug, it cannot be exploited to force an application to perform any task the application wouldn&#8217;t normally perform. For example, you cannot trick a web server to access files other than its web pages. SELinux also prevents most kinds of privilege escalation exploits.</p>
</div>
<div class="paragraph">
<p>SELinux is so effective that many CVEs which were considered severe in regular Linux systems have minimal impact, or no impact at all, on RHEL servers. For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://blog.hqcodeshop.fi/archives/243-SElinux-and-Shellshock.html">CVE-2014-6271 and CVE-2014-7169</a> a.k.a ShellShock</p>
</li>
<li>
<p><a href="https://access.redhat.com/security/cve/cve-2024-21626">CVE-2024-21626</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To be effective, SELinux relies on the availability of air-tight security policies that allow each individual application and system service to perform only the tasks they are supposed to perform.</p>
</div>
<div class="paragraph">
<p>Notice that SELinux cannot prevent an application from doing things it&#8217;s supposed to do. For example, an SQL injection vulerability in a web application would allow an application to access other data it already has access to but end users shouldn&#8217;t see. SELinux wouldn&#8217;t prevent such a scenario: it ether allows the application access to the remote database server or doesn&#8217;t.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_who_provides_selinux_policies"><a class="anchor" href="#_who_provides_selinux_policies"></a>Who Provides SELinux Policies</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Red Hat provides a comprehensive policy for almost all packages included with RHEL and its add-on products but, if you deploy any application from a third-party vendor, you must load a policy that is specifically tailored for that application. As you are attending this course, you are probably involved with creating such a policy.</p>
</div>
<div class="paragraph">
<p>Red Hat is not the only vendor that recommends enabling and configuring SELinux. As an example, see some <a href="https://docs.datadoghq.com/security/default_rules/xccdf-org-ssgproject-content-rule-selinux-policytype/">advice from DataDog</a>.</p>
</div>
<div class="paragraph">
<p>Unfortunately, few IT vendors stepped up to provide SELinux policies for their products, and instead leave the burden on their customers.</p>
</div>
<div class="paragraph">
<p>Among the vendors who stepped up we can name Microsoft, which provides an <a href="https://techcommunity.microsoft.com/t5/sql-server-blog/sql-server-2022-now-available-for-both-rhel-9-and-ubuntu-22-04/ba-p/3896410">SELinux policy for the MS SQL Server database</a>.</p>
</div>
<div class="paragraph">
<p>Some vendors provide unsupported sample policies, and may warn customers that these policies require customization for the customer&#8217;s environment, but they still encourage their customers to use SELinux for additional security. For example, IBM already provided <a href="https://www.ibm.com/docs/en/db2/11.5?topic=security-enhanced-linux-selinux">sample SELinux policies for DB2</a> way before IBM acquired Red Hat.</p>
</div>
<div class="paragraph">
<p>Some vendors who used to advise disabling SELinux, for fear of performance degradation, nowadays recommend that customers run with SELinux enabled and in enforcing mode. For example SAP supports running <a href="https://community.sap.com/t5/technology-blogs-by-members/selinux-and-sap-hana/ba-p/13547102">SAP Hana with SElinux</a>. By the way, you can find members of the SAP community who guide their fellow users on <a href="https://community.sap.com/t5/additional-blogs-by-sap/what-about-sap-and-selinux/ba-p/12844463">how to create SELinux policies to protect SAP applications</a>.</p>
</div>
<div class="paragraph">
<p>Even without a policy designed specifically for that application, it&#8217;s still much better having SELinux policies that protect everything else in a server than disabling SELinux</p>
</div>
<div class="paragraph">
<p>If your organization has an internal software development group, ideally that group provides SELinux policies alongisde their application binaries and configuration files. This is consistent with the expectation that they would provide instructions on firewall settings, filesystem permissions, and other requirements for deploying their application.</p>
</div>
<div class="paragraph">
<p>If they don&#8217;t, then the system administrator resposible fo securing the deployment must work with them to create such a policy.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_what_you_need_to_create_custom_selinux_policies"><a class="anchor" href="#_what_you_need_to_create_custom_selinux_policies"></a>What You Need to Create Custom SELinux Policies</h2>
<div class="sectionbody">
<div class="paragraph">
<p>All tools required to create, deploy, manage, and troubleshoot SELinux policies are included with RHEL. You do not need programming not scripting knowledge to create and validate SELinux policies.</p>
</div>
<div class="paragraph">
<p>Creating an SELinux policy requires intimate knowledge about the architecture and implementation of the target application. By "intimate knowledge" it doesn&#8217;t mean access to the application&#8217;s source code and understanding of its internal implementation details. It means understanding of what an aplication does, to the level you are able to answer questions such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Does it make sense for that application to read the contents of /directory/file?</p>
</li>
<li>
<p>Does it make sense for that application to listen on TCP Port N?</p>
</li>
<li>
<p>Does it make sense for that application to open network connections to api.example.com?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In fact, RHEL includes tooling to generate policies automatically from executable files, web server scripts, containers, and other kinds of applications. But you cannot verify if the resulting policy is too permissive (or not pemissive enough) without good knowledge about the target application.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_do_selinux_policies_require_customization"><a class="anchor" href="#_why_do_selinux_policies_require_customization"></a>Why Do SELinux Policies Require Customization?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Most software are configurable with different paths for data files, log files, and network ports for incoming connections. Access to these paths, ports, and other kernel objects must be allowed by SELinux.</p>
</div>
<div class="paragraph">
<p>Of course, no preexisting policy can anticipate all variations of file paths, network ports, and other configuration details that a user could choose, for all possible deployment scenarios of an application. If an SELinux policy is designed over rigid configuration assumptions, it forces uses to use the software under those assumptions only.</p>
</div>
<div class="paragraph">
<p>SELinux provides many ways you can design a policy to be maleable and yet ensure an application cannot be abused by exploring known and unknown bugs. We will learn about those mechanisms later in this course.</p>
</div>
<div class="paragraph">
<p>In the worst case scenario, system administrators can configure an application to run in <strong>permissive mode</strong>. In that mode, SELinux does not block access from the application to anything. The application will be unprotected and vulnerable ot exploits, but the remaining of the system will still be protected.</p>
</div>
<div class="paragraph">
<p>In fact, the recommended workflow for creating a custom SELinux policy starts by running the target applications in permissive mode.</p>
</div>
<div class="paragraph">
<p>While it is possible to put the entire system in permissive move, this is rarely necessary.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_unconfined_processes_and_objects"><a class="anchor" href="#_unconfined_processes_and_objects"></a>Unconfined Processes and Objects</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You could cheat and create a policy which states that a process can do aything. SELinux makes it somewhat hard to create such a policy, but Red Hat includes, as part of the policies within RHEL, what is called <strong>unconfined</strong> processes: applications with unrestricted access all objects. For unconfined processes, SELinux effectively provide no security.</p>
</div>
<div class="paragraph">
<p>For example, all processes that a user starts from an interactive login are unconfined. This way a user can run any application to access their own files, without requiring custom policies. User files are still protected by SELinux from access by system services which run as confined processes.</p>
</div>
<div class="paragraph">
<p>Unconfined processes may not be acceptable for some high-security organizations, such as those involved with national defense. For these organizaitons, SELinux enables you to configure Multi Level Security (MLS) policies with enforce distinct security clearance levels, and confine all users (and all their processes) to a specific clearance level. This course does not teach how to handle such scenarios.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_from_here_on_raw_copy_and_paste_from_other_sources_pending_reorganization"><a class="anchor" href="#_from_here_on_raw_copy_and_paste_from_other_sources_pending_reorganization"></a>FROM HERE ON, RAW COPY-AND-PASTE FROM OTHER SOURCES, PENDING REORGANIZATION</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://docs.google.com/presentation/d/11K6ykCk2d9QySZ3rVzJWnX6FADEGLCacVAmumbBlENs/edit#" class="bare">https://docs.google.com/presentation/d/11K6ykCk2d9QySZ3rVzJWnX6FADEGLCacVAmumbBlENs/edit#</a></p>
</div>
<div class="sect2">
<h3 id="_proactive_security_slides_4_10"><a class="anchor" href="#_proactive_security_slides_4_10"></a>Proactive security: slides 4-10</h3>
<div class="paragraph">
<p>PROACTIVE SECURITY</p>
</div>
<div class="paragraph">
<p>REACTIVE SECURITY</p>
</div>
<div class="paragraph">
<p>Figure with time line of buggy software release, bug discovered, and bug patched.</p>
</div>
<div class="paragraph">
<p>YOUR SYSTEM IS NOT PROTECTED DURING THE WINDOW OF VULNERABILITY!</p>
</div>
<div class="paragraph">
<p>PROACTIVE SECURITY HELPS TO PROTECT YOUR SYSTEM DURING THE WINDOW OF VULNERABILITY!</p>
</div>
</div>
<div class="sect2">
<h3 id="_what_is_selinux_slides_11_18"><a class="anchor" href="#_what_is_selinux_slides_11_18"></a>What is SELinux: slides #11-18</h3>
<div class="paragraph">
<p>SECURITY ENHANCED LINUX IS A SECURITY MECHANISM BRINGING PROACTIVE SECURITY FOR YOUR SYSTEM.</p>
</div>
<div class="paragraph">
<p>TECHNOLOGY FOR PROCESS ISOLATION TO MITIGATE ATTACKS VIA PRIVILEGE ESCALATION</p>
</div>
<div class="paragraph">
<p>EXPLOIT EXAMPLES WHERE SELINUX HELPED TO PROTECT YOUR SYSTEM</p>
</div>
<div class="paragraph">
<p>DOCKER CVE-2016-9962
SHELLSHOCK
<a href="https://access.redhat.com/articles/1212303" class="bare">https://access.redhat.com/articles/1212303</a>
runc - Malicious container escape
<a href="https://access.redhat.com/security/vulnerabilities/runcescape" class="bare">https://access.redhat.com/security/vulnerabilities/runcescape</a>
CVE-2024-21626
<a href="https://access.redhat.com/security/cve/cve-2024-21626" class="bare">https://access.redhat.com/security/cve/cve-2024-21626</a></p>
</div>
<div class="paragraph">
<p>TRADITIONAL LINUX SECURITY</p>
</div>
<div class="paragraph">
<p>File permission bits</p>
</div>
<div class="paragraph">
<p>PROBLEMS
ROOT BYPASSING THIS SECURITY
SETUID BIT</p>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="index.html">Review of SELinux</a></span>
  <span class="next"><a href="s2-intro-quiz.html">Quiz: Do you need a custom SELinux policy?</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
