<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Lab: Configure SElinux for a Web Application :: Writing Targeted Policies for SELinux on RHEL</title>
    <link rel="prev" href="s1-support.html">
    <link rel="next" href="s3-avc.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">Writing Targeted Policies for SELinux on RHEL</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/selinux-policies/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="selinux-policies" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Writing Targeted Policies for SELinux on RHEL</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../ch1-need/index.html">Review of SELinux</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch1-need/s1-intro.html">Why You Should Care About SELinux</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../ch1-need/s2-intro-quiz.html">Quiz: Do you need a custom SELinux policy?</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../ch1-need/s2-intro-quiz-answers.html">Answers to the Quiz</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch1-need/s3-setup-lab.html">Lab: Verify the Status of SELinux in a RHEL Machine</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch1-need/s4-labels.html">SELinux Policies, Labels, and Contexts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch1-need/s5-labels-lab.html">Lab: Explore Labels and Policy Rules in a RHEL Machine</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch1-need/s6-rhel.html">How Red Hat Protects System Services With SELinux on RHEL</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch1-need/s7-confined-lab.html">Lab: Explore Confined and Unconfined Processes in RHEL</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch1-need/s8-summary.html">Summary</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">SELinux Management</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="s1-support.html">Supporting SELinux</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="s2-webapp-lab.html">Lab: Configure SElinux for a Web Application</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="s3-avc.html">Interpreting AVC messages</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="s4-troubleshoot-lab.html">Lab: Troubleshoot SELinux policies</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="s5-multihost.html">Consistent SElinux settings</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="s6-ansible-lab.html">Lab: Automate SELinux Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="s7-summary.html">Summary</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../ch3-policy/index.html">Extending SELinux Policies</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch3-policy/s1-generate.html">Create a Custom SELinux Policy</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch3-policy/s2-generic-lab.html">Lab: Generate a Generic SElinux Policy Module</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Writing Targeted Policies for SELinux on RHEL</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Writing Targeted Policies for SELinux on RHEL</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Writing Targeted Policies for SELinux on RHEL</a></li>
    <li><a href="index.html">SELinux Management</a></li>
    <li><a href="s2-webapp-lab.html">Lab: Configure SElinux for a Web Application</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Lab: Configure SElinux for a Web Application</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><em>Estimated reading time: <strong>5 minutes</strong>.</em></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Objective</dt>
<dd>
<p>Troubleshoot SELinux errors from an Apache Web Server and configure SELinux to fix those errors.</p>
</dd>
</dl>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Pending Review
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_before_you_begin"><a class="anchor" href="#_before_you_begin"></a>Before you Begin</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You need a RHEL machine to which you have the root password or unrestricted sudo and access to Red Hat Enterprise Linux package repositories, to install any missing packages. That machine must also be configured with:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SELinux enabled and enforcing, using the targeted policy.</p>
</li>
<li>
<p>The <code>setools-console</code> package.</p>
</li>
<li>
<p>The <code>policycoreutils-python-utils</code> package.</p>
</li>
<li>
<p>The <code>httpd</code> package.</p>
</li>
<li>
<p>The <code>mysqld-server</code> package.</p>
</li>
<li>
<p>The <code>git</code> client.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These instructions were tested on RHEL 9.3 but should work with minimal change on older releases (since RHEL 7) and newer releases.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_instructions"><a class="anchor" href="#_instructions"></a>Instructions</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download a sample web site with includes dynamic pages using the PHP server-side scripting language.</p>
<div class="paragraph">
<p>1.1. Clone the course samples repository, if you didn&#8217;t in a previous activity, and enter the <code>quotes</code> diretory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>git clone https://github.com/RedHatQuickCourses/selinux-policies-samples.git</strong>
...
Resolving deltas: 100% (25/25), done.
$ <strong>cd selinux-policies-samples/quotes</strong>
$ <strong>ls</strong>
db.sql  hello.php  index.html  quotes.php</code></pre>
</div>
</div>
<div class="paragraph">
<p>1.2. Verify if the prequisite Apache Web Server and MySQL database server packages are installed. It should be fine if you have different versions of those packages. If they are not, please install them:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>rpm -q httpd</strong>
httpd-2.4.57-5.el9.x86_64
$ <strong>rpm -q mysql-server</strong>
mysql-server-8.0.32-1.el9_2.x86_64</code></pre>
</div>
</div>
<div class="paragraph">
<p>1.3. Install the PHP scripting language, its CLI utility, and its MySQL database driver, as prerequisites of the quotes web site:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>sudo dnf -y install php php-cli php-mysqlnd</strong>
...
Complete!</code></pre>
</div>
</div>
<div class="paragraph">
<p>1.4. Start the Apache Web Server and the MySQL database server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>systemctl start httpd</strong>
$ <strong>systemctl start mysqld</strong>
$ <strong>systemctl is-active httpd</strong>
active
$ <strong>systemctl is-active mysqld</strong>
active</code></pre>
</div>
</div>
<div class="paragraph">
<p>1.5. Use the provided SQL script to initialie the quotes database:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>sudo mysql &lt; db.sql</strong></code></pre>
</div>
</div>
</li>
<li>
<p>Install the quote applicaion on the Apache Web Server document root by making a very common mistake: moving files between directories with different SELinux contexts:</p>
<div class="paragraph">
<p>2.1. Move the welcome page and the dynamic pages from the git repository to the Apache Web Sever document root:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>sudo mv *.html *.php /var/www/html/</strong>
$ <strong>ls -Za -1 /var/www/html/</strong>
system_u:object_r:httpd_sys_content_t:s0 .
system_u:object_r:httpd_sys_content_t:s0 ..
    unconfined_u:object_r:user_home_t:s0 hello.php
    unconfined_u:object_r:user_home_t:s0 index.html
    unconfined_u:object_r:user_home_t:s0 quotes.php</code></pre>
</div>
</div>
<div class="paragraph">
<p>2.2. If the output of the previous command shows a different SELinux context type on the HTML and PHP files, force them to the incorrect type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>sudo chcon -t user_home_t /var/www/html/\</strong>*</code></pre>
</div>
</div>
<div class="paragraph">
<p>Remember that, if you move files between different file systems, they do not retain their permissions and SELinux context, but inherit them from the destination directory.</p>
</div>
</li>
<li>
<p>Verify that the Apache Web Server cannot serve the welcome page you just installed.</p>
<div class="paragraph">
<p>3.2 Try to retrive the welcome page, it is expected to fail. Feel free to use a real web browser intead of the <code>curl</code> command, if you like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>curl http://127.0.0.1/</strong>
&lt;!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN"&gt;
&lt;html&gt;&lt;head&gt;
&lt;title&gt;403 Forbidden&lt;/title&gt;
&lt;/head&gt;&lt;body&gt;
&lt;h1&gt;Forbidden&lt;/h1&gt;
&lt;p&gt;You don't have permission to access this resource.&lt;/p&gt;
&lt;/body&gt;&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>3.3. Check that the welcome page is world-readable, so the access error was not caused by file permission bits:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>ls -la /var/www/html/</strong>
total 12
drwxr-xr-x. 2 root    root     59 Jul 22 18:22 .
drwxr-xr-x. 4 root    root     33 Jul 18 14:48 ..
-rw-r--r--. 1 student student  53 Jul 22 16:58 hello.php
-rw-r--r--. 1 student student 328 Jul 22 17:32 index.html
-rw-r--r--. 1 student student 955 Jul 22 18:22 quotes.php</code></pre>
</div>
</div>
<div class="paragraph">
<p>3.4. Check that the audit log has an event from SELinux
sudo ausearch -m avc -ts recent</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>sudo ausearch -m avc -ts recent</strong>
----
time-&gt;Mon Jul 22 17:09:56 2024
type=PROCTITLE msg=audit(1721682596.879:196): proctitle=2F7573722F7362696E2F6874747064002D44464F524547524F554E44
type=SYSCALL msg=audit(1721682596.879:196): arch=c000003e syscall=257 success=no exit=-13 a0=ffffff9c a1=7f023400a4e8 a2=80000 a3=0 items=0 ppid=3099 pid=3108 auid=4294967295 uid=48 gid=48 euid=48 suid=48 fsuid=48 egid=48 sgid=48 fsgid=48 tty=(none) ses=4294967295 comm="httpd" exe="/usr/sbin/httpd" subj=system_u:system_r:httpd_t:s0 key=(null)
type=AVC msg=audit(1721682596.879:196): avc:  denied  { read } for  pid=3108 comm="httpd" name="index.html" dev="vda4" ino=25927060 scontext=system_u:system_r:httpd_t:s0 tcontext=unconfined_u:object_r:user_home_t:s0 tclass=file permissive=0</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that the event refers to the <code>httpd</code> executable and to the <code>index.html</code> file, so it must be related to the error acessing the welcome page.</p>
</div>
</li>
<li>
<p>Fix the context on HTML and PHP pages and verify that the quotes dynamic page fails to work.</p>
<div class="paragraph">
<p>4.1. Restore the default SELinux context of web pages, as stated by the currently loaded policy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>restorecon -fv /var/www/html/\</strong>*
Relabeled /var/www/html/hello.php from unconfined_u:object_r:user_home_t:s0 to system_u:object_r:httpd_sys_content_t:s0
Relabeled /var/www/html/index.html from unconfined_u:object_r:user_home_t:s0 to system_u:object_r:httpd_sys_content_t:s0
Relabeled /var/www/html/quotes.php from unconfined_u:object_r:user_home_t:s0 to system_u:object_r:httpd_sys_content_t:s0</code></pre>
</div>
</div>
<div class="paragraph">
<p>4.2. Revisit the welcome page, it should work this time:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>curl http://127.0.0.1/</strong>
&lt;html&gt;
  &lt;body&gt;
    &lt;h1&gt;Famous Quotes&lt;/h1&gt;
    &lt;p&gt;
    Click to get a  &lt;a href="quotes.php"&gt;random quote&lt;/a&gt; related to the IT field.
    &lt;p&gt;
    The selected quotes are based on the blog post by &lt;a href="https://www.freshworks.com/freshservice/general/top-it-quotes-blog/"&gt;Ankit Ranjan&lt;/a&gt;.
  &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>4.3. Click the link to the "random quote", or visit it using the <code>curl</code> command. You should get what looks, from a web browser, like an empty page, but which is actually a truncated response. This is a sign of trouble, besides a sign of a badly designed application which does not perform any error handling:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>curl http://127.0.0.1/quotes.php</strong>
&lt;html&gt;
&lt;body&gt;
&lt;h1&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>4.4. Check the Apache Web Server logs. The error log should show only the error from the first attempt to access the web page, and the access log should show an internal error (HTTP 500) which is quite common with unhandled errors from PHP scripts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>sudo tail -n 1 /var/log/httpd/error_log</strong>
[Mon Jul 22 17:09:56.881213 2024] [core:error] [pid 3108:tid 3297] (13)Permission denied: [client 127.0.0.1:49108] AH00132: file permissions deny server access: /var/www/html/index.html
$ <strong>sudo tail -n 1 /var/log/httpd/access_log</strong>
127.0.0.1 - - [22/Jul/2024:17:33:16 -0400] "GET /quotes.php HTTP/1.1" 500 - "-" "curl/7.76.1"</code></pre>
</div>
</div>
<div class="paragraph">
<p>4.5. Check the audit log for SELinux errors, and you should see an event which mentions both PHP and MySQL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>sudo ausearch -m avc -ts recent</strong>
----
time-&gt;Mon Jul 22 17:33:16 2024
type=PROCTITLE msg=audit(1721683996.862:250): proctitle=7068702D66706D3A20706F6F6C20777777
type=SYSCALL msg=audit(1721683996.862:250): arch=c000003e syscall=42 success=no exit=-13 a0=6 a1=7fec3b803040 a2=10 a3=7ffef0c425a0 items=0 ppid=3100 pid=3101 auid=4294967295 uid=48 gid=48 euid=48 suid=48 fsuid=48 egid=48 sgid=48 fsgid=48 tty=(none) ses=4294967295 comm="php-fpm" exe="/usr/sbin/php-fpm" subj=system_u:system_r:httpd_t:s0 key=(null)
type=AVC msg=audit(1721683996.862:250): avc:  denied  { name_connect } for  pid=3101 comm="php-fpm" dest=3306 scontext=system_u:system_r:httpd_t:s0 tcontext=system_u:object_r:mysqld_port_t:s0 tclass=tcp_socket permissive=0</code></pre>
</div>
</div>
</li>
<li>
<p>Verify that the Apache Web Server can run PHP scripts. Also verify that PHP scripts, when executed interactively, can access MySQL databases.</p>
<div class="paragraph">
<p>5.1. Visit the hello page, which is hidden from normal navigation. It is quite common that dynamic web sites have a few hidden pages for troubleshooting purposes and for health reporting to monitoring systems:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>curl http://127.0.0.1/hello.php</strong>
&lt;html&gt;
&lt;body&gt;
Hello world
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>5.2. Run the quotes script interactively. You may get a different quote, but it proves the script works:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>php -f /var/www/html/quotes.php</strong>
&lt;html&gt;
&lt;body&gt;
&lt;h1&gt;
IT is ever-changing and there is the need to evolve in order to stay relevant.
&lt;/h1&gt;
&lt;p&gt;
&lt;a href="/index.html"&gt;Back&lt;/a&gt; | &lt;a href="../quotes.php"&gt;Another quote&lt;/a&gt;
&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is expected that applications which fail to run on confined domains from system services work on unconfined domains from interactive users.</p>
</div>
</li>
<li>
<p>Enable the boolean that allows the Apache Web Server confined domain to open network connections to databases and retry the dynamic page.</p>
<div class="paragraph">
<p>6.1. List the available booleans from the Apache Web Server, as you know many optional features are enabled by those booleans. The list is quite long, but among them are many booleans related to network connections:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>getseboolean -a | grep httpd</strong>
...
httpd_can_network_connect --&gt; off
httpd_can_network_connect_cobbler --&gt; off
httpd_can_network_connect_db --&gt; off
httpd_can_network_memcache --&gt; off
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>6.2. Enable the boolean which allows network connections to databases:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>sudo setsebool httpd_can_network_connect_db on</strong>
$ <strong>getsebool httpd_can_network_connect_db</strong>
httpd_can_network_connect_db --&gt; on</code></pre>
</div>
</div>
<div class="paragraph">
<p>6.3. Revisit the "random quote" page. It should now work:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>curl http://127.0.0.1/quotes.php</strong>
&lt;html&gt;
&lt;body&gt;
&lt;h1&gt;
The 4 Ps for Change and Release: Planning Prevents Poor Performance.
&lt;/h1&gt;
&lt;p&gt;
&lt;a hef="/quotes.php"&gt;Another quote&lt;/a&gt;
&lt;/body&gt;
&lt;p&gt;
&lt;a href="/index.html"&gt;Back&lt;/a&gt; | &lt;a href="../quotes.php"&gt;Another quote&lt;/a&gt;
&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_next_steps"><a class="anchor" href="#_next_steps"></a>Next Steps</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Just setting the correct context labels on files and other resources and enabling the correct booleans can go a long way to ensure you can run applications securely under the targeted policy set from RHEL.</p>
</div>
<div class="paragraph">
<p>The next section will focus on interpreting SELinux audit events and tools which help you assess if it&#8217;s the case of configuring a server or addig custom policy.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_from_here_on_raw_copy_and_paste_from_other_sources_pending_reorganization"><a class="anchor" href="#_from_here_on_raw_copy_and_paste_from_other_sources_pending_reorganization"></a>FROM HERE ON, RAW COPY-AND-PASTE FROM OTHER SOURCES, PENDING REORGANIZATION</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://docs.google.com/presentation/d/11K6ykCk2d9QySZ3rVzJWnX6FADEGLCacVAmumbBlENs/edit#" class="bare">https://docs.google.com/presentation/d/11K6ykCk2d9QySZ3rVzJWnX6FADEGLCacVAmumbBlENs/edit#</a></p>
</div>
<div class="sect2">
<h3 id="_http_with_nfs_slides_145_158"><a class="anchor" href="#_http_with_nfs_slides_145_158"></a>Http with NFS: slides #145-158</h3>
<div class="paragraph">
<p>What does ausearch say</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs"># ausearch -m AVC -m USER_AVC -ts today</code></pre>
</div>
</div>
<div class="paragraph">
<p>type=AVC msg=audit(1395177286.929:1638): avc:  denied  { read } for  pid=6591 comm="httpd" name="webpages" dev="0:37" ino=2112 scontext=system_u:system_r:httpd_t:s0 tcontext=system_u:object_r:nfs_t:s0 tclass=dir</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs"># ausearch -m AVC -m USER_AVC -ts today | audit2allow
...
# sealert -a avc
...</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">#============= httpd_t ==============
#!!!! This avc can be allowed using one of the these booleans:
# 	httpd_use_nfs, git_system_use_nfs
allow httpd_t nfs_t:dir read;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs"># semanage boolean -l | grep httpd_use_nfs
# semanage boolean -m --on httpd_use_nfs</code></pre>
</div>
</div>
<div class="paragraph">
<p>type=AVC msg=audit(1491948261.488:599): avc:  denied  { name_bind } for  pid=5920 comm="httpd" src=3131 scontext=system_u:system_r:httpd_t:s0 tcontext=system_u:object_r:unreserved_port_t:s0 tclass=tcp_socket</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs"># semanage port -l | grep 80
http_port_t                	tcp  	80, 81, 443, 488, 8008,   8009, 8443, 9000

# sesearch -A -s httpd_t -t http_port_t  -c tcp_socket  -p name_bind
Found 1 semantic av rules:
  allow httpd_t http_port_t : tcp_socket name_bind ;

# semanage port -a -t http_port_t -p tcp 3131
# semanage port -l | grep http_port_t
http_port_t                	tcp  	3131, 80, 81, 443, 488, 8008,   8009, 8443, 9000</code></pre>
</div>
</div>
<div class="paragraph">
<p>type=AVC msg=audit(1491949594.146:622): avc:  denied  { read } for  pid=6094 comm="httpd" name="index.html" dev="dm-0" ino=13485999 scontext=system_u:system_r:httpd_t:s0 tcontext=unconfined_u:object_r:var_t:s0 tclass=file</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs"># matchpathcon /var/test_www/html/index.html
/var/test_www/html/index.html    system_u:object_r:var_t:s0

# matchpathcon /var/www/html/index.html
/var/www/html/index.html    system_u:object_r:httpd_sys_content_t:s0

# semanage fcontext -a -t httpd_sys_content_t "/var/test_www(/.*)?"
# restorecon -Rv /var/</code></pre>
</div>
</div>
<div class="paragraph">
<p>type=AVC msg=audit(1491949594.146:622): avc:  denied  { read } for  pid=6094 comm="httpd" name="index.html" dev="dm-0" ino=13485999 scontext=system_u:system_r:httpd_t:s0 tcontext=unconfined_u:object_r:unlabeled_t:s0 tclass=file</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs"># restorecon -Rv /
# fixfiles onboot &amp;&amp; reboot</code></pre>
</div>
</div>
<div class="paragraph">
<p>type=AVC msg=audit(1491949594.146:622): avc:  denied  { read } for  pid=6094 comm="httpd" name="db" dev="dm-0" ino=13485999 scontext=system_u:system_r:httpd_t:s0 tcontext=unconfined_u:object_r:mysql_log_t:s0 tclass=file</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs"># audit2allow -i avc
#============= httpd_t ==============
allow httpd_t mysqld_log_t:file read;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs"># audit2allow -i avc -M local_httpd
<strong><strong></strong><strong></strong></strong><strong><strong></strong><strong></strong></strong> IMPORTANT <strong><strong></strong><strong></strong></strong><strong><strong></strong><strong></strong></strong><strong>*</strong>
To make this policy package active, execute:
semodule -i local_httpd.pp
# semodule -i local_httpd.pp</code></pre>
</div>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="s1-support.html">Supporting SELinux</a></span>
  <span class="next"><a href="s3-avc.html">Interpreting AVC messages</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
